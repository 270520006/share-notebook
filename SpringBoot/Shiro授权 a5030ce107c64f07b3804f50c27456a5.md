# Shiro授权

## 判断设置访问指定请求的用户是否有该访问权限

```java
/**
 * 添加shiro内置过滤器
 *
 * anon     所有的用户都可以访问
 * authc    必须认证了才能访问
 * user     必须拥有记住我功能才能访问
 * perms    拥有对某个资源的权限才能访问
 * role     拥有某个角色权限才能访问
 */
// 初始化拦截参数map
Map<String, String> filterMap = new LinkedHashMap<>();

//配置请求权限信息  判断访问此路径的用户是否有 add权限
**filterMap.put("/user/add", "perms[user:add]");**

// 配置拦截授权信息
filterMap.put("/user/**", "authc");

// 配置如果currentUser访问的页面未授权跳转的页面
**shiroFilterFactoryBean.setUnauthorizedUrl("/unAuthorized");**
```

- 授权使用 filterMap去添加访问某些请求需要的权限
- 当用户访问需要权限的请求路径的时候,需要去继承了**AuthorizingRealm**的类里(一般起名为**Realm**)实现了**doGetAuthorization()**的执行授权操作的方法里访问该subjectUser是否有个访问这个请求及下页面的权限
- 可以在**doGetAuthorization**()方法里面对用户进行授权,但是如何访问当前用户的信息呢?     需要从**Realm** 类实现的另一个方法**doGetAuthentication()**执行认证方法去设置当前用户的**principal对象信息,**也就是将当前用户的数据库信息,全部放在**principal对象中,** 最后将认证信息返回**,**那么我们就可以通过**SecurityUtils.getSubject();**获取当前的对象,再获取对象的 principal属性,最后就可以获取到数据库权限的信息
- 获取到数据权限的信息后我们就可以将这些信息设置给  SimpleAuthorizationInfo info= new SimpleAuthorizationInfo();授权对象了,可以通过授权对象对用户进行授权,使用 info.addStringPermissions()方法授予当前用户的权限,当用户访问某些需要权限访问的请求时,就可以通过,访问到页面
- 方法⬇️

```java
// 获取当前用户对象
Subject subject = SecurityUtils.getSubject();
// 初始化授权信息对象
SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo();
// 获取principal对象,强转为用户对象,因为principal对象封装了用户对象信息
User user = (User) subject.getPrincipal();
// 给用户授权
simpleAuthorizationInfo.addStringPermission(user.getPermissions());
```

- 授权的目的到达了,新的问题接踵而来,如:用户只有add添加的权限,但是还是会显示update的权限,如果进行屏蔽当前用户没用权限的页面呢？那我们就该考虑到与thymeleaf整合来进行页面判断屏蔽