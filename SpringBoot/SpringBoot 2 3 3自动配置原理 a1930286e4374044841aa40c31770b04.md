# SpringBoot 2.3.3自动配置原理

---

# 自动配置:

- 解析SpringBoot   Pom.xml  SpringBoot主要依赖来自父工程的依赖

```xml
<parent>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-dependencies</artifactId>
<version>2.3.3.RELEASE</version>
</parent>
```

- 我们在写或者引入SpringBoot依赖的时候 不需要指定版本 就是因为有这些仓库版本

---

# SpringBoot启动器:

- 说白了就是SpringBoot的启动场景

```xml
				<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>
```

- 例如spring-boot-starter-web就会帮助我们自动导入web环境的所有依赖
- springboot会将所有的功能场景变成一个个的启动器
- 如果我们要使用某些功能,只需要找到相对应的启动器就行了

# Spring主程序理解

- 注解  @SpringBootApplication 标注的类是一个SpringBoot的应用

```java
	@SpringBootApplication
public class SpringboothelloworldApplication {

    public static void main(String[] args) {
				//启动SpringBoot
        SpringApplication.run(SpringboothelloworldApplication.class, args);
    }

}
```

---

# @AutoConfigurationPackage：自动配置包

```java
@AutoConfigurationPackage
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {
```

@AutoConfigurationPackage:自动配置包

@Import(AutoConfigurationPackages.Registrar.class):导入一个自动配置包的注册器

Spirng的底层注解将给容器中导入一个组件,导入的组件由AutoConfigurationPackages.Registart.class;

将主配置@SpringBootApplication标注的类，所在的包及下面所有的子包里面所有的组件扫描到Spring容器中

@Import(AutoConfigurationImportSelector.class):导入→开启自动配置导入选择器

给容器中导入组件？

AutoConfigurationImportSelector：导入哪些组件的。选择器

importSelectors方法将需要导入的组件以全类名的方式返回,这些组件就会被添加到容器中

会给容器中导入非常多的自动配置类(xxxAutoConfiguration)，就是给容器中导入这个场景所需要的组件，并且配置好这些组件

![SpringBoot%202%203%203%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%20a1930286e4374044841aa40c31770b04/Snipaste_2020-09-09_15-18-21.png](SpringBoot%202%203%203%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%20a1930286e4374044841aa40c31770b04/Snipaste_2020-09-09_15-18-21.png)

有了自动配置类，免去了我们手动编写注入功能组件的工作

SpringFactories.LoadFactoryNames(EnableAutoConfiguration.class,classLoader)

通过里面的方法去获取类路径下的META-INF/Spring.factories中获取EnableConfiguration指定的值。将这些值作为自动配置类导入到容器中,自动配置就生效了，帮我们进行自动配置工作

# SpringBoot 的Condition 条件成立才给容器中添加组件,配置配到里面的内容才会生效

> 相当于,只有当你指定好springboot的启动场景,使用springboot的工具类下的SpringFactoriesLoader 流程为:

通过 AutoConfigurationImportSelector(自动配置导入选择器)去选择 获取要自动配置的条目,也就是通过 getAutoConfigurationEntry方法()获取，通过getAutoConfigurationEntry()方法再去获取候选的配置(也就是 getCandidataConfiguration方法) ,最后通过getCondidateConfiguration方法内的SpringFactoriesLoader 的 loadFactoryNames方法下的loadSpringFactories方法去加载 spring.favorite配置文件，然后根据(getOrDefault(factoryName,EmptyList()方法)  )去判断 LoadSpringFactories 加载的配置类是否和传入的factory工厂的类型及factoryName相同,如果相同则保存到LoadFactoryNames()方法的List集合中。集合中的内容为SpringBoot要导入的自动配置类的全限定名。将这些组件加入到SpringBoot容器之前，会通过组件内的@Conditional或者@ConditionalOnXXX来判断是否符合加入容器条件,将符合条件的组件通过@Configuration配置都加载到当前SpringBoot创建并使用的IOC容器。

![SpringBoot%202%203%203%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%20a1930286e4374044841aa40c31770b04/Snipaste_2020-09-09_09-13-59.png](SpringBoot%202%203%203%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%20a1930286e4374044841aa40c31770b04/Snipaste_2020-09-09_09-13-59.png)